# Farkleゲーム仕様書

## 1. ゲーム概要

- 6個のサイコロを使用するスコアベースのダイスゲーム
- 各ターンでサイコロを振り、得点組み合わせを作る
- リスクとリターンのバランスを考慮した戦略的ゲーム
- 目標スコア10,000点に最初に到達したプレイヤーが勝利
- モバイルファーストで設計し、タッチ操作に最適化
- motion による心地よいアニメーション体験

## 2. ゲームルール

### 2.1 基本ルール

- **ゲーム開始**: 各プレイヤーは0点からスタート
- **ターンの流れ**:
  1. 6個のサイコロを振る
  2. 得点になる組み合わせを選択
  3. 残りのサイコロで継続するか、得点を確定するかを選択
  4. 継続する場合は残りのサイコロを振る
  5. Farkle（得点なし）になった場合、そのターンの得点は0点

### 2.2 得点システム

| 組み合わせ | 得点 |
|-----------|------|
| 1（単体） | 100点 |
| 5（単体） | 50点 |
| 3個同じ数字（1以外） | 数字×100点 |
| 3個の1 | 1,000点 |
| 4個同じ数字 | 3個の得点×2 |
| 5個同じ数字 | 4個の得点×2 |
| 6個同じ数字 | 5個の得点×2 |
| ストレート（1-2-3-4-5-6） | 1,000点 |
| 3ペア | 750点 |
| 4個+2個 | 1,500点 |

### 2.3 特殊ルール

- **Farkle**: 得点になる組み合わせがない場合、そのターンの得点は全て失われる
- **ホットダイス**: 6個全てのサイコロで得点を作った場合、再び6個で継続可能
- **最初の得点**: 初回得点時は最低500点必要
- **勝利条件**: 10,000点に到達し、他のプレイヤーに最終ターンを与えて最高得点を維持

## 3. 機能要件

### 3.1 基本機能

- **ゲーム画面**
  - 6個のサイコロ表示（3D風デザイン）
  - 現在のスコア表示
  - ターンスコア表示
  - プレイヤー情報表示
  - motion によるアニメーション：
    - サイコロ振りアニメーション（回転＋バウンス）
    - 選択時のハイライトアニメーション
    - 得点表示時のポップアップアニメーション

- **操作機能**
  - サイコロ振りボタン
  - サイコロ選択/選択解除（タップ）
  - 得点確定ボタン（Bank）
  - 継続ボタン（Roll Again）
  - ゲーム終了/リセットボタン

### 3.2 モバイル最適化 UI

- **レイアウト**
  ```
  モバイル（縦向き）:
  +------------------+
  |     Farkle       |
  | Player 1: 2,450  |
  | Turn: 350        |
  +------------------+
  |                  |
  |   🎲 🎲 🎲      |
  |   🎲 🎲 🎲      |
  |                  |
  | Selected: 1,5    |
  | Score: 150       |
  +------------------+
  | [Roll] [Bank]    |
  | [New Game]       |
  +------------------+
  ```

- **タッチターゲット**
  - サイコロサイズ: 60×60px以上
  - ボタン最小サイズ: 44×44px
  - 適切な余白とタッチエリア

### 3.3 アニメーション仕様（motion）

- **サイコロアニメーション**
  ```javascript
  // サイコロ振り
  animate={{
    rotateX: [0, 360, 720],
    rotateY: [0, 180, 360],
    y: [0, -50, 0],
    scale: [1, 1.1, 1]
  }}
  transition={{
    duration: 1.2,
    ease: "easeOut"
  }}
  
  // 選択状態
  whileTap={{ scale: 0.95 }}
  animate={{
    scale: isSelected ? 1.1 : 1,
    boxShadow: isSelected ? "0 0 20px #FFD700" : "0 2px 8px rgba(0,0,0,0.2)"
  }}
  ```

- **得点アニメーション**
  ```javascript
  // 得点ポップアップ
  initial={{ opacity: 0, y: 20, scale: 0.8 }}
  animate={{ opacity: 1, y: 0, scale: 1 }}
  exit={{ opacity: 0, y: -20, scale: 0.8 }}
  transition={{ type: "spring", stiffness: 300, damping: 20 }}
  ```

### 3.4 ゲームモード

- **シングルプレイヤー**
  - AIプレイヤー（簡単・普通・難しい）
  - スコアアタックモード（制限時間内で最高得点）
  - 練習モード（得点計算の学習）

- **マルチプレイヤー**
  - ローカル対戦（デバイス共有）
  - ホットシート方式（交代でプレイ）

### 3.5 チュートリアル機能

- **初回起動モーダル**
  - ゲームルール説明（スライド形式）
  - 得点表の表示
  - インタラクティブなデモプレイ
  - アニメーション付きの操作説明

- **ヘルプ機能**
  - ゲーム中のルール確認
  - 得点計算表の表示
  - 戦略のヒント

### 3.6 統計・記録機能

- **プレイ記録**
  - 最高得点
  - 平均得点
  - プレイ回数
  - 勝率（AI戦）
  - 最長連勝記録

- **統計表示**
  - グラフによる得点推移
  - Farkle回数の統計
  - よく使う得点パターンの分析

## 4. 非機能要件

### 4.1 モバイル UX

- **ジェスチャー**
  - サイコロのドラッグ選択（複数選択）
  - スワイプでプレイヤー切り替え
  - プルダウンで新規ゲーム

- **画面対応**
  - 縦向き最適化（横向きも対応）
  - ノッチ/セーフエリア対応
  - 最小対応画面: 320px 幅

### 4.2 パフォーマンス

- 初回読み込み: 3秒以内
- サイコロアニメーション: 60fps維持
- タッチ遅延: 50ms以内
- **motion の最適化**:
  - GPU加速の活用
  - アニメーション最適化
  - メモリ使用量の最適化

### 4.3 アクセシビリティ

- 色覚異常対応（色以外の識別手段）
- 大きなフォントサイズ対応
- スクリーンリーダー対応
- 動きを抑えた表示オプション

## 5. 技術仕様

### 5.1 フレームワーク・ライブラリ

- **フレームワーク**: Next.js 15 (App Router) + React 19 + TypeScript
- **アニメーション**: motion
- **スタイリング**: Tailwind CSS v4（モバイルファースト）
- **状態管理**: React Hooks (useState, useReducer, useContext)
- **ストレージ**: localStorage（統計・設定保存）

### 5.2 コンポーネント設計

```
app/farkle/
├── page.tsx                 # メインゲームページ
├── components/
│   ├── GameBoard.tsx        # ゲーム盤面
│   ├── Dice.tsx            # サイコロコンポーネント
│   ├── ScoreDisplay.tsx    # スコア表示
│   ├── PlayerInfo.tsx      # プレイヤー情報
│   ├── GameControls.tsx    # ゲーム操作ボタン
│   ├── ScoreCalculator.tsx # 得点計算表示
│   ├── TutorialModal.tsx   # チュートリアル
│   ├── GameOverModal.tsx   # ゲーム終了画面
│   └── StatisticsModal.tsx # 統計画面
├── hooks/
│   ├── useFarkleGame.tsx   # ゲームロジック
│   ├── useScoreCalculation.tsx # 得点計算
│   ├── useGameStatistics.tsx   # 統計管理
│   └── useGameStorage.tsx      # データ保存
├── types/
│   └── farkle.ts           # 型定義
└── utils/
    ├── scoreCalculator.ts  # 得点計算ロジック
    ├── gameLogic.ts       # ゲームルール実装
    └── aiPlayer.ts        # AIプレイヤー
```

### 5.3 状態管理設計

```typescript
interface GameState {
  // ゲーム状態
  currentPlayer: number;
  players: Player[];
  gamePhase: 'rolling' | 'selecting' | 'banking' | 'gameOver';
  
  // ターン状態
  dice: DiceValue[];
  selectedDice: boolean[];
  turnScore: number;
  rollsInTurn: number;
  
  // ゲーム設定
  targetScore: number;
  gameMode: 'single' | 'multi';
  aiDifficulty: 'easy' | 'normal' | 'hard';
}

interface Player {
  id: number;
  name: string;
  totalScore: number;
  isAI: boolean;
  statistics: PlayerStats;
}
```

## 6. UI/UX デザイン原則

### 6.1 視覚デザイン

- **カラーパレット**
  - メイン: ダークグリーン（フェルトテーブル風）
  - アクセント: ゴールド（得点・選択状態）
  - サイコロ: アイボリー（立体感）
  - 警告: レッド（Farkle状態）

- **サイコロデザイン**
  - 3D風の立体表現
  - 適切な影とハイライト
  - アニメーション時の物理的な動き
  - 選択状態のグロー効果

### 6.2 モーションデザイン

- **サイコロの動き**
  - 物理的な重量感
  - バウンス効果
  - 回転の慣性
  - 着地時の振動

- **UI フィードバック**
  - ボタン押下時の即座な反応
  - 得点表示時の祝福感
  - Farkle時の残念感の演出

### 6.3 サウンドデザイン（オプション）

- サイコロ振り音
- サイコロ選択音
- 得点獲得音
- Farkle時の効果音
- BGM（設定でON/OFF）

## 7. 実装フェーズ

### Phase 1: 基本ゲーム実装
- サイコロ表示・操作
- 基本的な得点計算
- シンプルなUI

### Phase 2: アニメーション・UX向上
- motionによるアニメーション
- モバイル最適化
- タッチ操作の改善

### Phase 3: 機能拡張
- AIプレイヤー
- 統計機能
- チュートリアル

### Phase 4: 最終調整
- パフォーマンス最適化
- アクセシビリティ対応
- バグ修正・テスト

## 8. テスト観点

- **ゲームロジックテスト**
  - 得点計算の正確性
  - ゲーム状態の整合性
  - エッジケースの処理

- **UIテスト**
  - レスポンシブデザイン
  - タッチ操作の精度
  - アニメーションの滑らかさ

- **パフォーマンステスト**
  - 読み込み速度
  - メモリ使用量
  - バッテリー消費