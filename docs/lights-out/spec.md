# ライツアウトゲーム

## 1. ゲーム概要

- 5×5 のグリッド上で行うパズルゲーム
- 各セルはライトのオン/オフ状態を持つ
- セルをタップすると、そのセルと上下左右の隣接セルの状態が反転
- 全てのライトを消灯させることが目的
- モバイルファーストで設計し、タッチ操作に最適化
- framer-motion による心地よいアニメーション体験

## 2. 機能要件

### 2.1 基本機能

- **ゲームボード**

  - 5×5 のグリッド表示（モバイル画面に最適化）
  - 各セルのオン/オフ状態を視覚的に表現
  - framer-motion によるアニメーション：
    - タップ時のスケールアニメーション
    - 状態変化時のフェード/回転アニメーション
    - スプリング効果による自然な動き

- インタラクション
  - タッチフィードバック（触覚フィードバック対応）
  - **framer-motion の whileTap**でタップ時の視覚的フィードバック
  - ドラッグ無効化（誤操作防止）
  - 長押し防止

### 2.2 モバイル最適化 UI

- **レイアウト**

  ```
  モバイル（縦向き）:
  +------------------+
  |   ライツアウト    |
  |                  |
  |  手数: 12        |
  |  時間: 01:23     |
  +------------------+
  |                  |
  |   ● ● ● ● ●    |
  |   ● ● ● ● ●    |
  |   ● ● ● ● ●    |
  |   ● ● ● ● ●    |
  |   ● ● ● ● ●    |
  |                  |
  +------------------+
  | [新規] [リセット] |
  |    [難易度]      |
  +------------------+
  ```

- **タッチターゲット**
  - 最小タッチエリア: 44×44px
  - セル間の適切な余白
  - 誤タップ防止の配慮

### 2.3 アニメーション仕様（framer-motion）

- **セルアニメーション**

  ```javascript
  // タップ時
  whileTap={{ scale: 0.9 }}

  // 状態変化時
  animate={{
    backgroundColor: isOn ? "#FFD700" : "#2C3E50",
    rotate: isOn ? 180 : 0,
    scale: isOn ? 1.1 : 1
  }}
  transition={{
    type: "spring",
    stiffness: 300,
    damping: 20
  }}
  ```

- **連鎖アニメーション**

  - 中心から隣接セルへの波及効果
  - staggerChildren 使用で順次アニメーション

- **ゲームクリア演出**

  - 全セルの順次消灯アニメーション
  - 祝福メッセージのフェードイン
  - 紙吹雪エフェクト（オプション）

  ### 2.4 チュートリアル機能

- **初回起動モーダル**
  - ゲーム起動時に自動表示（初回のみ）
  - スキップ可能、後から再表示可能
  - **内容**：
    - ゲームルール説明
    - 操作方法のアニメーション付きデモ
    - 目的（全て消灯）の明示
  - **framer-motion 演出**：
    - モーダルのフェードイン/スライドイン
    - ステップごとのトランジション
    - インタラクティブなデモ（実際にタップ可能）

### 2.5 ヒント機能

- **ヒントボタン**
  - 困った時に使用可能
  - 使用回数の制限（難易度による）
  - **動作**：
    - 最適解の次の一手を示す
    - 該当セルを点滅アニメーション
    - framer-motion でパルスエフェクト
    ```javascript
    animate={{
      scale: [1, 1.2, 1],
      opacity: [1, 0.7, 1],
    }}
    transition={{
      duration: 0.8,
      repeat: Infinity,
      ease: "easeInOut"
    }}
    ```

### 2.6 操作履歴機能

- **履歴記録**

  - 各操作をタイムスタンプ付きで記録
  - タップしたセルの座標
  - その時点での盤面状態
  - 手数カウント

- **履歴表示 UI**

  **PC 版**：

  ```
  +------------------+------------------+
  |                  |   操作履歴        |
  |   ゲーム画面      |  ---------------  |
  |                  |  1. (2,3) 00:05  |
  |                  |  2. (4,1) 00:12  |
  |                  |  3. (3,3) 00:18  |
  |                  |  ...             |
  |                  |  [クリア] [再生]  |
  +------------------+------------------+
  ```

  **モバイル版**：

  - ヘッダーにハンバーガーメニュー
  - タップでドロップダウンメニュー展開
  - メニュー項目：
    - 「操作履歴を見る」
    - 「ルール説明」
    - 「設定」
    - 「統計」
  - 履歴はモーダルで表示

- **履歴機能詳細**
  - **再生機能**：操作を順番に再現
  - **特定手番へジャンプ**：任意の状態に戻る
  - **最適解との比較**：効率性の可視化
  - **アニメーション**：
    - 履歴項目のスタガーアニメーション
    - ホバー/タップ時のハイライト
    - スムーズなスクロール

### 2.7 レスポンシブ対応の詳細

**ブレークポイント**：

- モバイル: < 768px
- タブレット: 768px - 1024px
- デスクトップ: > 1024px

**レイアウト切り替え**：

```javascript
// PC版レイアウト
<div className="flex">
  <GameBoard className="flex-1" />
  <HistoryPanel className="w-80" />
</div>

// モバイル版レイアウト
<div>
  <Header>
    <HamburgerMenu />
  </Header>
  <GameBoard className="w-full" />
  <HistoryModal isOpen={isHistoryOpen} />
</div>
```

## 3. 非機能要件（更新）

### 3.1 モバイル UX

- **ジェスチャー**

  - スワイプで難易度切り替え
  - ピンチ操作は無効化
  - プルダウンリフレッシュで新規ゲーム

- **画面対応**
  - 縦向き最適化（横向きも対応）
  - ノッチ/セーフエリア対応
  - 最小対応画面: 320px 幅

### 3.2 パフォーマンス

- 初回読み込み: 3 秒以内
- アニメーション FPS: 60fps 維持
- タッチ遅延: 50ms 以内
- **framer-motion の最適化**:
  - layout prop の適切な使用
  - will-change の自動管理

## 4. 技術仕様

- **フレームワーク**: React + TypeScript
- **アニメーション**: framer-motion
- **スタイリング**: Tailwind CSS（モバイルファースト設計）
- **状態管理**: React Hooks (useState, useReducer)
- **PWA 対応**: オフライン動作、ホーム画面追加

## 5. UI/UX デザイン原則

- **視覚デザイン**

  - 大きく見やすい UI 要素
  - 高コントラストな配色
  - 角丸でソフトな印象
  - グラデーション使用で深みを演出

- **モーションデザイン**
  - 意味のあるアニメーション
  - 過度でない適切な動き
  - ユーザーアクションへの即座のフィードバック
  - アクセシビリティ設定での動き削減対応

### 5.1 モーダルデザイン

- **チュートリアルモーダル**

  - オーバーレイ背景（半透明）
  - 中央配置、適切なパディング
  - 閉じるボタン明確化
  - スワイプでページ送り（モバイル）

- **履歴モーダル**
  - 画面下部からスライドアップ（モバイル）
  - 最大高さ 80vh
  - プルダウンで閉じる

### 5.2 ナビゲーション

- **ハンバーガーメニュー**
  - 右上配置（モバイル）
  - アニメーション付き開閉
  - メニュー項目は大きめのタップターゲット
  - アクティブ状態の明示